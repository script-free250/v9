<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>وحدة التحليل</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="live-counter" id="liveCounter" style="top:10px; right:10px;">Live: ...</div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0; border: none; font-size: 1.5rem;">تحليل الإشارة</h2>
            <div style="font-size: 12px; color: var(--hacker-green); font-weight: bold; text-shadow:0 0 5px var(--hacker-green);">متصل ●</div>
        </div>

        <p style="color: #666;">جاري سحب البيانات من السيرفر...</p>

        <div class="monitor-screen">
            <div style="font-size: 0.8rem; color: #555; text-align: left; direction: ltr;">TARGET_SIGNAL_VAL</div>
            <div class="big-number" id="randomNumber">--.--</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div style="text-align: right; font-size: 0.7rem; color: #555; margin-top: 5px;">التحديث: 7s</div>
        </div>

        <button class="secondary-btn" onclick="logout()">قطع الاتصال</button>
    </div>

    <script>
        if (!localStorage.getItem('isLoggedIn')) window.location.href = 'index.html';

        // Live Counter logic
        setInterval(() => {
            document.getElementById('liveCounter').innerText = `Live: ${Math.floor(Math.random() * 50) + 300}`;
        }, 3000);

        const display = document.getElementById('randomNumber');
        const bar = document.getElementById('progressFill');
        const INTERVAL = 7000;
        let start = Date.now();

        function gen() {
            let n = (Math.random() * 29 + 1).toFixed(2);
            display.style.opacity = 0;
            setTimeout(() => { display.innerText = n; display.style.opacity = 1; }, 100);
            start = Date.now();
        }

        function loop() {
            let elapsed = Date.now() - start;
            let remain = INTERVAL - elapsed;
            if(remain <= 0) gen();
            else bar.style.width = ((remain/INTERVAL)*100) + "%";
            requestAnimationFrame(loop);
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'index.html';
        }

        gen();
        requestAnimationFrame(loop);
    </script>
</body>
</html>
